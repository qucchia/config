#+title:Raspberry Pi Setup
#+PROPERTY: header-args:shell :tangle ./setup.sh

This script installs and sets up all my configuration on a newly installed Raspberry Pi OS.

* Set environment variables

#+begin_src shell

  export CONFIG_DIR=$HOME/Documents/config
  SETUP_DIR=$CONFIG_DIR/setup

#+end_src

* Install applications

** Remove preinstalled applications

#+begin_src shell

  sudo apt purge geany thonny -y
  # sudo apt purge chromium-browser
  sudo apt autoremove -y

#+end_src

** Add APT sources
      
#+begin_src shell

  # Add Firefox source
  sudo echo "deb http://ports.ubuntu.com/ubuntu-ports bionic-updates main" >> /etc/apt/sources.list
  sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 3B4FE6ACC0B21F32
  sudo ln $SETUP_DIR/99bionic-updates /etc/apt/preferences.d/99bionic-updates

#+end_src

** Update and Upgrade

#+begin_src shell

  sudo apt update
  sudo apt upgrade -y

#+end_src

** Install base applications

#+begin_src shell

  sudo apt install emacs isync mu4e pass firefox -y

#+end_src

** Tor

#+begin_src shell

  sudo apt install tor -y
  sudo ln -f $SETUP_DIR/torrc /etc/tor/torrc

#+end_src

** Node

#+begin_src shell

  curl -sL https://deb.nodesource.com/setup_16.x | sudo -E bash -
  sudo apt install -y nodejs
  sudo npm i -g typescript typescript-language-server prettier

#+end_src

* Set up git

#+begin_src shell

  git config --global user.name qucchia
  git config --global user.email "qucchia0@gmail.com"
  git config --global init.defaultBranch main
  cat $SETUP_DIR/.authinfo-model >> ~/.authinfo
  echo "To get forge working properly see https://magit.vc/manual/ghub/Creating-and-Storing-a-Token.html#Creating-and-Storing-a-Token"

#+end_src

** SSH

#+begin_src shell

  ssh-keygen -t ed25519 -C "qucchia0@gmail.com"
  echo "Copy the key above and add it to your codeberg.org account to get SSH working."
  cd $CONFIG_DIR
  git remote set-url origin git@codeberg.org:qucchia/config

#+end_src

** Clone repositories

#+begin_src shell

  mkdir -p ~/Projects ~/Mail
  git clone git@codeberg.org:qucchia/life ~/Documents/life
  git clone git@codeberg.org:qucchia/school ~/Documents/school
  git clone git@codeberg.org:qucchia/mafia-bot ~/Projects/mafia-bot

#+end_src

* Install fonts

#+begin_src shell

  mkdir -p ~/.local/share/fonts
  cd /tmp
  git clone -q https://github.com/adobe-fonts/source-code-pro.git
  cp source-code-pro/TTF/*.ttf ~/.local/share/fonts
  fc-cache -f -v

#+end_src

* Set up Emacs and EXWM

#+begin_src shell

  ln -s $CONFIG_DIR/emacs/init.el ~/.emacs.d/init.el
  sudo ln -f $CONFIG_DIR/exwm/EXWM.desktop /usr/share/xsessions/EXWM.desktop

  echo "sh ~/Documents/config/exwm/start-exwm.sh" > ~/.xsession
  bash ~/.xsession

  emacsclient $SETUP_DIR/FinalSetup.org

#+end_src
